%{
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int tempCount = 0;

typedef struct node {
    char name[20];
} NODE;

NODE* makeNode(char *str) {
    NODE *newNode = (NODE*)malloc(sizeof(NODE));
    strcpy(newNode->name, str);
    return newNode;
}

NODE* makeTemp() {
    NODE *newNode = (NODE*)malloc(sizeof(NODE));
    sprintf(newNode->name, "t%d", ++tempCount);
    return newNode;
}

void gen(char *res, char *op1, char op, char *op2) {
    printf("%s = %s %c %s\n", res, op1, op, op2);
}
%}

%union { char *string; NODE *node; }

%token <string> ID NUM
%type <node> expr term factor

%left '+' '-'
%left '*' '/'

%%
stmt: expr '\n'   { printf("\nIntermediate Code Generated Successfully.\n"); }
    ;

expr: expr '+' term  { NODE *temp = makeTemp(); gen(temp->name, $1->name, '+', $3->name); $$ = temp; }
    | expr '-' term  { NODE *temp = makeTemp(); gen(temp->name, $1->name, '-', $3->name); $$ = temp; }
    | term           { $$ = $1; }
    ;

term: term '*' factor { NODE *temp = makeTemp(); gen(temp->name, $1->name, '*', $3->name); $$ = temp; }
    | term '/' factor { NODE *temp = makeTemp(); gen(temp->name, $1->name, '/', $3->name); $$ = temp; }
    | factor          { $$ = $1; }
    ;

factor: ID   { $$ = makeNode($1); }
      | NUM  { $$ = makeNode($1); }
      | '(' expr ')' { $$ = $2; }
      ;
%%
int main() {
    printf("Enter arithmetic expression: ");
    yyparse();
    return 0;
}

int yyerror(char *s) {
    printf("Error: %s\n", s);
    return 0;
}

